<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Admin Dashboard - FoodieHub</title>
  <meta name="description" content="Admin panel for Food Ordering System"/>

  <!-- External CSS -->
  <link rel="stylesheet" href="../assets/css/style.css">

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="admin-body">

  <!-- Admin Header -->
  <header class="admin-header">
    <div class="container admin-header-container">
      <div class="logo">
        <h1>Foodie<span>Hub</span> <small>Admin</small></h1>
      </div>

      <nav class="admin-nav">
        <ul>
          <li><a href="dashboard.html" class="active">Dashboard</a></li>
          <li><a href="#users-section">Users</a></li>
          <li><a href="#categories-section">Categories</a></li>
          <li><a href="foods.html">Foods</a></li>
          <li><a href="#orders-section">Orders</a></li>
          <li><a href="#" id="logout-btn">Logout</a></li>
        </ul>
      </nav>

      <button class="mobile-menu-toggle" aria-label="Toggle menu">
        <span></span><span></span><span></span>
      </button>
    </div>
  </header>

  <!-- Main Admin Content -->
  <main class="admin-main">
    <div class="container">

      <!-- Statistics Cards -->
      <section class="stats-section">
        <h2>Dashboard Overview</h2>
        <div class="stats-grid" id="stats-grid">
          <div class="stat-card">
            <div class="stat-icon">üë•</div>
            <h3>Total Users</h3>
            <p class="stat-value" id="total-users">‚Äî</p>
          </div>
          <div class="stat-card">
            <div class="stat-icon">üì¶</div>
            <h3>Total Orders</h3>
            <p class="stat-value" id="total-orders">‚Äî</p>
          </div>
          <div class="stat-card">
            <div class="stat-icon">üçî</div>
            <h3>Total Foods</h3>
            <p class="stat-value" id="total-foods">‚Äî</p>
          </div>
          <div class="stat-card">
            <div class="stat-icon">üìã</div>
            <h3>Total Categories</h3>
            <p class="stat-value" id="total-categories">‚Äî</p>
          </div>
          <div class="stat-card revenue">
            <div class="stat-icon">üí∞</div>
            <h3>Total Revenue</h3>
            <p class="stat-value" id="total-revenue">‚Äî</p>
          </div>
        </div>
      </section>

      <!-- Users Management -->
      <section class="admin-section" id="users-section">
        <h2>Users Management</h2>
        <div class="table-container">
          <table class="admin-table">
            <thead>
              <tr>
                <th>Full Name</th>
                <th>Email</th>
                <th>Phone</th>
                <th>Role</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="users-table-body">
              <!-- Populated via JS -->
            </tbody>
          </table>
        </div>
        <div class="loading" id="users-loading">Loading users...</div>
        <div class="error-message" id="users-error" style="display:none;"></div>
      </section>

      <!-- Categories Management -->
      <section class="admin-section" id="categories-section">
        <h2>Categories Management</h2>

        <!-- Create Category Form -->
        <form id="create-category-form" class="admin-form">
          <h3>Add New Category</h3>
          <div class="form-row">
            <input type="text" id="category-name" placeholder="Category Name" required>
            <input type="text" id="category-desc" placeholder="Description (optional)">
            <button type="submit" class="btn btn-primary">Create Category</button>
          </div>
        </form>

        <div class="table-container">
          <table class="admin-table">
            <thead>
              <tr>
                <th>Category Name</th>
                <th>Description</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="categories-table-body">
              <!-- Populated via JS -->
            </tbody>
          </table>
        </div>
        <div class="loading" id="categories-loading">Loading categories...</div>
      </section>

      <!-- Orders Overview -->
      <section class="admin-section" id="orders-section">
        <h2>Orders Overview</h2>
        <div class="table-container">
          <table class="admin-table orders-table">
            <thead>
              <tr>
                <th>Order ID</th>
                <th>Customer</th>
                <th>Total</th>
                <th>Status</th>
                <th>Date</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="orders-table-body">
              <!-- Populated via JS -->
            </tbody>
          </table>
        </div>
        <div class="loading" id="orders-loading">Loading orders...</div>
        <div class="error-message" id="orders-error" style="display:none;"></div>
      </section>

    </div>
  </main>

  <!-- Footer -->
  <footer class="footer">
    <div class="container">
      <p>¬© 2025 FoodieHub Admin Panel. All rights reserved.</p>
    </div>
  </footer>

  <!-- JavaScript Files -->
  <script type="module">
    import { getCurrentUser, logoutUser } from '../backend/js/auth.js';
    import {
      getDashboardStats,
      getAllUsers,
      deleteUser,
      getAllOrders,
      getCurrentAdminDashboard,
      getCurrentAdminUsers,
      getCurrentAdminOrders
    } from '../backend/js/admin.js';

    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    // DOM Elements
    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    const logoutBtn        = document.getElementById('logout-btn');
    const statsGrid        = document.getElementById('stats-grid');
    const usersTableBody   = document.getElementById('users-table-body');
    const categoriesTableBody = document.getElementById('categories-table-body');
    const ordersTableBody  = document.getElementById('orders-table-body');

    const usersLoading     = document.getElementById('users-loading');
    const ordersLoading    = document.getElementById('orders-loading');
    const usersError       = document.getElementById('users-error');
    const ordersError      = document.getElementById('orders-error');

    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    // Authentication & Logout
    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    const user = getCurrentUser();
    if (!user || user.role_name?.toLowerCase() !== 'admin') {
      alert('Admin access required. Redirecting to login...');
      window.location.href = 'login.html';
    }

    logoutBtn.addEventListener('click', (e) => {
      e.preventDefault();
      if (confirm('Are you sure you want to logout?')) {
        logoutUser('login.html');
      }
    });

    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    // Load Dashboard Stats
    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    async function loadDashboard() {
      try {
        const res = await getCurrentAdminDashboard();
        if (res.success) {
          document.getElementById('total-users').textContent     = res.data.total_users;
          document.getElementById('total-orders').textContent    = res.data.total_orders;
          document.getElementById('total-foods').textContent     = res.data.total_foods;
          document.getElementById('total-categories').textContent = res.data.total_categories;
          document.getElementById('total-revenue').textContent   = formatPrice(res.data.total_revenue);
        }
      } catch (err) {
        console.error('Dashboard load failed:', err);
      }
    }

    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    // Load Users
    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    async function loadUsers() {
      usersLoading.style.display = 'block';
      usersTableBody.innerHTML = '';

      try {
        const res = await getCurrentAdminUsers();
        usersLoading.style.display = 'none';

        if (res.success && res.data.length > 0) {
          res.data.forEach(user => {
            const row = document.createElement('tr');
            row.innerHTML = `
              <td>${user.full_name}</td>
              <td>${user.email}</td>
              <td>${user.phone || '‚Äî'}</td>
              <td><span class="role-badge ${user.role_name.toLowerCase()}">${user.role_name}</span></td>
              <td>
                <button class="btn btn-danger btn-sm delete-user-btn" data-id="${user.id}">Delete</button>
              </td>
            `;
            usersTableBody.appendChild(row);
          });

          // Delete buttons
          document.querySelectorAll('.delete-user-btn').forEach(btn => {
            btn.addEventListener('click', async () => {
              if (confirm('Delete this user permanently?')) {
                try {
                  await deleteUser(user.id, btn.dataset.id);
                  loadUsers(); // refresh
                } catch {}
              }
            });
          });
        } else {
          usersTableBody.innerHTML = '<tr><td colspan="5" class="text-center">No users found.</td></tr>';
        }
      } catch (err) {
        usersLoading.style.display = 'none';
        usersError.textContent = 'Failed to load users. Please try again.';
        usersError.style.display = 'block';
      }
    }

    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    // Initialize Dashboard
    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    document.addEventListener('DOMContentLoaded', () => {
      loadDashboard();
      loadUsers();
      // loadCategories(); // if you want to implement category management here
      // loadOrders();
    });
  </script>
</body>
</html>