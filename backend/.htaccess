# Food Ordering System - Production .htaccess (Apache)
# Clean URLs, REST API routing, basic security

<IfModule mod_rewrite.c>
    RewriteEngine On
    RewriteBase /

    # 1. Prevent directory browsing
    Options -Indexes

    # 2. Redirect all requests to index.php (except real files/directories)
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^ index.php [L]

    # 3. Optional: Force HTTPS (uncomment in production)
    # RewriteCond %{HTTPS} off
    # RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

    # 4. Remove trailing slash (optional, for cleaner URLs)
    RewriteCond %{REQUEST_URI} /+$
    RewriteRule ^(.+)/+$ $1 [R=301,L]

    # 5. Block access to sensitive files and folders
    RewriteRule ^(\.env|\.git|config/|core/|middleware/|utils/|uploads/.*\.php)$ - [F,L]
    RewriteRule ^backend/.*\.php$ - [F,L]
</IfModule>

# 6. Set default index file
DirectoryIndex index.php

# 7. Security Headers (basic protection)
<IfModule mod_headers.c>
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-XSS-Protection "1; mode=block"
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
    Header always set Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data:; font-src 'self' data:;"
    Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains" env=HTTPS
</IfModule>

# 8. Enable compression for text-based assets
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript application/json
</IfModule>

# 9. Better caching for static assets
<IfModule mod_expires.c>
    ExpiresActive On
    ExpiresByType image/jpg "access plus 1 month"
    ExpiresByType image/jpeg "access plus 1 month"
    ExpiresByType image/gif "access plus 1 month"
    ExpiresByType image/png "access plus 1 month"
    ExpiresByType image/svg+xml "access plus 1 month"
    ExpiresByType text/css "access plus 1 week"
    ExpiresByType application/javascript "access plus 1 week"
    ExpiresByType application/json "access plus 1 hour"
</IfModule>

# 10. Prevent hotlinking (optional - uncomment if needed)
# RewriteCond %{HTTP_REFERER} !^$
# RewriteCond %{HTTP_REFERER} !^https?://(www\.)?yourdomain\.com/ [NC]
# RewriteRule \.(jpg|jpeg|png|gif|svg)$ - [NC,F,L]